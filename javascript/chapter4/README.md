# 第4章 函数

JavaScript中最好的特性就是它对函数的实现。它几乎无所不能。

函数包含一组语句，它们是JavaScript的基础模块单元，用于代码复用、信息隐藏和组合调用。函数用于指定对象的行为。一般来说，所谓编程就是将一组需求分解成一组函数和数据结构的技能。

## 4.1 函数对象

在JavaScript中函数就是对象。对象是“名/值”对的集合并拥有一个连到原型对象的隐藏连接。对象字面量产生的对象连接到Object.prototype。函数对象连接到Function.prototype（该原型对象本身连接到Object.prototype）。每个函数在创建时附有两个附加的隐藏属性：函数的上下文和实现函数行为的代码。

每个函数对象在创建时也随带有一个prototype属性。它的值是一个拥有constructor属性且值即为该函数的对象。这和隐藏连接到Function.prototype完全不同。这个令人费解的构造过程的意义将会在下个章节中揭示。

因为函数是对象，所以它们可以像任何其他的值一样被使用。函数可以存放在变量、对象和数组中。函数可以被当作参数传递给其他函数，函数也可以再返回函数。而且，因为函数是对象，所以函数可以拥有方法。

函数的与众不同之处在于它们可以被调用。

## 4.2 函数字面量

函数对象可以通过函数字面量来创建：

	// 创建一个名为add的变量，并用来把两个数字相加 
	
	var add = function (a, b) {
		return a + b;
	};

函数字面量包括四个部分。第一个部分是保留字function。函数可以用它的名字来递归地调用自己。此名字也能被调试器和开发工具用来识别函数。如果没有给函数明明，如上，它会被认为是匿名函数。

函数的第三部分是包围在圆括号中的一组参数。其中每个参数用逗号分割。这些名称将被定义为函数中的变量。它们不像普通的变量那样将被初始化为undefined，而是在该函数被调用时，初始化为实际提供的参数的值。

第四部分是包围在花括号中的一组语句。这些语句是函数的主体。它们在函数被调用时执行。

函数字面量可以出现在任何允许表达式出现的地方。函数也可以被定义在其它函数中。一个内部函数自然可以访问自己的参数和变量，同时它也能方便地访问它被嵌套在其中的那个函数的参数和变量。通过函数字面量创建的函数对象包含一个连到外部上下文的连接。这被成为`闭包`。它是JavaScript强大表现力的根基。

## 4.3 调用 

调用一个函数将暂停当前函数的执行，传递控制权和参数给新函数。除了声明时定义的形式参数，每个函数接手两个附加的参数：this和arguments。参数this在面向对象编程中非常重要，它的值取决于调用的模式。在JavaScript中一共有四种调用模式：方法调用模式、函数调用模式、构造器调用模式和apply调用模式。这个模式在如何初始化关键参数this上存在差异。

### 方法调用模式

当一个函数被保存为对象的一个属性时，我们称它为一个`方法`。当一个方法被调用时，this被绑定到该对象。如果一个调用表达式包含一个属性存取表达式（即一个.点表达式或[subscript]下标表达式），那么它被当作一个方法来调用。

	// 创建myObject。它有一个value属性和一个increment方法。
	// increment方法接受一个可选的参数。如果参数不是数字，那么默认使用数字1

	var myObject = {
		value: 0;
		increment: function (inc) {
			this.value += (typof inc === 'number' ? inc : 1 );
		}
	};
	
	myObject.increment();
	document.writeln(myObject.value);

	myObject.increment(4);
	document.writeln(myObject.value);

方法使用this去访问对象，所以它能从对象中取值或修改该对象。this到对象的绑定发生在调用的时候。这个“超级”迟绑定（very late binding）使得函数可以对this高度复用。通过this可去的它们所属对象的上下文的方法成为`公共方法`。

### 函数调用模式

当一个函数并非一个对象的属性时，那么它被当作一个函数来调用：

	var sum = add(3, 4);   // sum的值为7

当函数以次模式调用时，this被绑定到全局对象。
